.rkanboard {
    --rkanboard-accent: var(--primary);
    --rkanboard-accent-rgb: var(--primary-rgb);
    --rkanboard-gap: var(--space-3);
    --rkanboard-column-padding: var(--space-3);
    --rkanboard-card-gap: var(--space-2);
    --rkanboard-card-padding: var(--space-3);
    --rkanboard-column-min-width: 280px;
    --rkanboard-column-max-width: 340px;

    display: flex;
    flex-direction: column;
    gap: var(--rkanboard-gap);
    width: 100%;

    &.density-compact {
        --rkanboard-gap: var(--space-2);
        --rkanboard-column-padding: var(--space-2);
        --rkanboard-card-gap: var(--space-1);
        --rkanboard-card-padding: var(--space-2);
    }

    &.density-dense {
        --rkanboard-gap: var(--space-2);
        --rkanboard-column-padding: var(--space-2);
        --rkanboard-card-gap: var(--space-1);
        --rkanboard-card-padding: var(--space-2);
    }

    &.density-spacious {
        --rkanboard-gap: var(--space-4);
        --rkanboard-column-padding: var(--space-4);
        --rkanboard-card-gap: var(--space-3);
        --rkanboard-card-padding: var(--space-4);
    }

    &.rkanboard-size-xs {
        --rkanboard-column-min-width: 220px;
        --rkanboard-column-max-width: 260px;
    }

    &.rkanboard-size-sm {
        --rkanboard-column-min-width: 260px;
        --rkanboard-column-max-width: 320px;
    }

    &.rkanboard-size-md {
        --rkanboard-column-min-width: 280px;
        --rkanboard-column-max-width: 340px;
    }

    &.rkanboard-size-lg {
        --rkanboard-column-min-width: 320px;
        --rkanboard-column-max-width: 380px;
    }

    &.rkanboard-size-xl {
        --rkanboard-column-min-width: 360px;
        --rkanboard-column-max-width: 420px;
    }

    &.rkanboard-variant-default,
    &.rkanboard-variant-primary {
        --rkanboard-accent: var(--primary);
        --rkanboard-accent-rgb: var(--primary-rgb);
    }

    &.rkanboard-variant-secondary {
        --rkanboard-accent: var(--secondary, var(--primary));
        --rkanboard-accent-rgb: var(--secondary-rgb, var(--primary-rgb));
    }

    &.rkanboard-variant-success {
        --rkanboard-accent: var(--success, var(--primary));
        --rkanboard-accent-rgb: var(--success-rgb, var(--primary-rgb));
    }

    &.rkanboard-variant-warning {
        --rkanboard-accent: var(--warning, var(--primary));
        --rkanboard-accent-rgb: var(--warning-rgb, var(--primary-rgb));
    }

    &.rkanboard-variant-error {
        --rkanboard-accent: var(--error, var(--primary));
        --rkanboard-accent-rgb: var(--error-rgb, var(--primary-rgb));
    }

    &.rkanboard-variant-info {
        --rkanboard-accent: var(--info, var(--primary));
        --rkanboard-accent-rgb: var(--info-rgb, var(--primary-rgb));
    }

    &.rkanboard-with-swimlanes {
        gap: var(--space-4);
    }

    &:focus-visible {
        outline: 2px solid rgba(var(--rkanboard-accent-rgb), 0.35);
        outline-offset: 2px;
    }
}

.rkanboard-toolbar {
    flex-wrap: wrap;
}

.rkanboard-template-bar {
    padding-bottom: var(--space-1);
    margin-bottom: var(--space-1);
    border-bottom: 1px dashed var(--border-light);
}

.rkanboard-template-item {
    display: inline-flex;
    align-items: center;
    gap: var(--space-1);
}

.rkanboard-template-badge {
    font-size: 0.65rem;
    padding: 0 var(--space-1);
    border-radius: var(--radius-pill);
    background: rgba(var(--rkanboard-accent-rgb), 0.12);
    color: var(--rkanboard-accent);
}

.rkanboard-body,
.rkanboard-swimlane-body {
    display: flex;
    gap: var(--rkanboard-gap);
    align-items: flex-start;

    &.is-vertical {
        flex-direction: row;
        overflow-x: auto;
        padding-bottom: var(--space-2);
    }

    &.is-horizontal {
        flex-direction: column;
        overflow-y: auto;
        max-height: 100%;
    }
}

.rkanboard-swimlane {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);

    &-header {
        padding: var(--space-2) var(--space-1);
        font-size: 0.7rem;
        text-transform: uppercase;
        letter-spacing: 0.04em;
        color: var(--text-muted);
    }
}

.rkanboard-column {
    background: var(--surface-elevated);
    border-radius: var(--radius-lg);
    border: 1px solid var(--border-light);
    min-width: var(--rkanboard-column-min-width);
    max-width: var(--rkanboard-column-max-width);
    display: flex;
    flex-direction: column;
    gap: var(--rkanboard-card-gap);
    padding: var(--rkanboard-column-padding);
    transition: border-color var(--transition-colors), box-shadow var(--transition-colors);

    &-compact {
        min-width: calc(var(--rkanboard-column-min-width) - 40px);
    }

    &-wide {
        min-width: calc(var(--rkanboard-column-min-width) + 40px);
        max-width: calc(var(--rkanboard-column-max-width) + 60px);
    }

    &-header {
        border-bottom: 1px solid rgba(0, 0, 0, 0.04);
        padding-bottom: var(--space-2);
    }

    &-body {
        min-height: 160px;
        display: flex;
        flex-direction: column;
        gap: var(--rkanboard-card-gap);
    }

    &-hidden {
        opacity: 0.5;
    }

    &-collapsed {
        border: 1px dashed var(--border-light);
        border-radius: var(--radius-md);
        padding: var(--space-2);
    }

    &.is-drop-target {
        border-color: rgba(var(--rkanboard-accent-rgb), 0.4);
        box-shadow: 0 0 0 2px rgba(var(--rkanboard-accent-rgb), 0.08);
    }
}

.rkanboard-card {
    background: var(--surface);
    border-radius: var(--radius-lg);
    border: 1px solid rgba(15, 23, 42, 0.08);
    box-shadow: var(--shadow-xs);
    cursor: grab;
    transition: transform var(--transition-transform), box-shadow var(--transition-colors), border-color var(--transition-colors), background-color var(--transition-colors);

    &:hover {
        border-color: rgba(15, 23, 42, 0.16);
        box-shadow: var(--shadow-sm);
    }

    &.is-dragging {
        opacity: 0.5;
        }

    &.is-focused {
        box-shadow: 0 0 0 2px rgba(var(--rkanboard-accent-rgb), 0.12);
        border-color: rgba(var(--rkanboard-accent-rgb), 0.4);
    }

    &:focus-visible {
        outline: 2px solid var(--rkanboard-accent);
        outline-offset: 2px;
    }

    &-content {
        padding: var(--rkanboard-card-padding);
        display: flex;
        flex-direction: column;
        gap: var(--rkanboard-card-gap);
    }

    &-badge {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border-radius: var(--radius-pill);
        font-size: 0.7rem;
        padding: 0 var(--space-2);
        background: var(--surface-muted);
        color: var(--text-muted);
    }

    &-chip {
        display: inline-flex;
        align-items: center;
        gap: var(--space-1);
        padding: 0 var(--space-2);
        font-size: 0.7rem;
        border-radius: var(--radius-pill);
        background: rgba(0, 0, 0, 0.04);
    }
}

.rkanboard-card-content {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
}

.rkanboard-card-top {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: var(--space-2);
    margin-bottom: var(--space-2);
}

.rkanboard-card-top-left {
    flex: 1 1 auto;
    min-width: 0;
}

.rkanboard-card-top-right {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: var(--space-1);
    flex-wrap: wrap;
}

.rkanboard-card-heading {
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
    min-width: 0;
}

.rkanboard-card-title-block {
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
}

.rkanboard-card-title {
    font-weight: 600;
    color: var(--text-primary);
}

.rkanboard-card-subtitle {
    color: var(--text-muted);
    line-height: 1.3;
}

.rkanboard-card-description {
    line-height: 1.4;
    margin-bottom: var(--space-1);
}

.rkanboard-card-priority {
    display: flex;
    flex-wrap: nowrap;
    justify-content: flex-end;
    gap: var(--space-1);
    min-width: 0;
}

.rkanboard-card-badges {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-1);
    margin-top: var(--space-1);
}

.rkanboard-card-meta {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
    color: var(--text-muted);
    margin-top: var(--space-1);
}

.rkanboard-card-actions {
    display: flex;
    justify-content: flex-end;
    gap: var(--space-1);

    .r-button {
        --button-padding-x: var(--space-2);
    }
}

.rkanboard-card-labels {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-1);
    margin-bottom: var(--space-1);
}

.rkanboard-card-label {
    display: inline-flex;
    align-items: center;
    gap: var(--space-1);
    padding: 0 var(--space-2);
    font-size: 0.65rem;
    border-radius: var(--radius-pill);
    background: rgba(var(--rkanboard-accent-rgb), 0.12);
    color: var(--text-muted);
    white-space: nowrap;

    .icon {
        font-size: 0.9em;
    }
}

.rkanboard-composer {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);

    &.is-open {
        background: rgba(15, 23, 42, 0.04);
        border: 1px dashed rgba(15, 23, 42, 0.14);
        border-radius: var(--radius-lg);
        padding: var(--space-3);
    }

    .r-button {
        width: 100%;
    }
}

.rkanboard-composer-shell {
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
}

.rkanboard-composer-fields {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
}

.rkanboard-composer-actions {
    display: flex;
    flex-wrap: wrap;
    justify-content: flex-end;
    gap: var(--space-2);

    .r-button {
        width: auto;
        min-width: 120px;
    }
}

.rkanboard-card-progress {
    display: flex;
    flex-direction: column;
    gap: var(--space-1);

    &-track {
        position: relative;
        width: 100%;
        height: 6px;
        border-radius: var(--radius-pill);
        background: rgba(0, 0, 0, 0.06);
        overflow: hidden;
    }

    &-fill {
        position: absolute;
        top: 0;
        left: 0;
        bottom: 0;
        background: var(--rkanboard-accent);
    }
}

.rkanboard-card-watchers {
    display: flex;
    align-items: center;
    gap: var(--space-1);

    .rkanboard-card-watcher {
        position: relative;
    }

    .rkanboard-card-watcher-avatar {
        width: 28px;
        height: 28px;
        border-radius: 999px;
        object-fit: cover;
        border: 1px solid rgba(0, 0, 0, 0.06);
        background: var(--surface-muted);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 0.7rem;
        color: var(--text-muted);

        &.placeholder {
            background: rgba(0, 0, 0, 0.04);
        }
    }

    .rkanboard-card-watcher-more {
        font-size: 0.7rem;
        color: var(--text-muted);
        padding: 0 var(--space-1);
    }
}

.rkanboard-column-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 1.25rem;
    padding: var(--space-half);
    border-radius: var(--radius-pill);
    background: rgba(var(--rkanboard-accent-rgb), 0.1);
    color: var(--rkanboard-accent);
}

.rkanboard-assignee {
    border-top: 1px solid rgba(0, 0, 0, 0.06);
    padding-top: var(--space-2);
    display: flex;
    flex-direction: column;
    gap: var(--space-2);

    &-header {
        font-size: 0.65rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--text-muted);
    }

    &-body {
        display: flex;
        flex-direction: column;
        gap: var(--space-2);
    }

    &-identity {
        display: flex;
        align-items: center;
        gap: var(--space-2);
    }

    &-details {
        display: flex;
        flex-direction: column;
        gap: var(--space-quarter);
    }

    &-name {
        font-weight: 600;
        color: var(--text-primary);
    }

    &-role {
        font-size: 0.7rem;
        text-transform: uppercase;
        letter-spacing: 0.04em;
        color: var(--text-muted);
    }

    &-controls {
        display: flex;
        flex-direction: row;
        gap: var(--space-2);
        align-items: flex-start;
        flex-wrap: wrap;
        margin-top: var(--space-2);
    }

    &-picker-wrap {
        flex: 1 1 auto;
        min-width: 220px;
    }

    &-picker {
        width: 100%;
        min-width: 220px;
    }

    &-actions {
        display: flex;
        align-items: center;
        .r-button {
            min-width: auto;
        }
    }

    &-unassign {
        --button-padding-x: var(--space-2);
        --button-padding-y: var(--space-1-5);
    }

    &-avatar {
        width: 32px;
        height: 32px;
        border-radius: 999px;
        object-fit: cover;
        background: var(--surface-muted);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        color: var(--text-muted);

        &.placeholder {
            background: var(--surface-muted);
            border: 1px solid rgba(0, 0, 0, 0.08);
        }
    }
}

.rkanboard-card-collaborators {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
    align-items: flex-start;
}

.rkanboard-collaborator-stack {
    display: flex;
    align-items: center;
    gap: var(--space-1);
    flex-wrap: wrap;
}

.rkanboard-collaborator-more {
    font-size: 0.7rem;
    color: var(--text-muted);
    padding: 0 var(--space-1);
}

.rkanboard-assignee-item {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-1) var(--space-2);
}

.rkanboard-composer-inline {
    margin-top: var(--space-3);
    min-width: var(--rkanboard-column-min-width);
    display: flex;

    .rkanboard-composer {
        width: 100%;
    }
}


.rkanboard-inline-editor {
    margin-top: var(--space-2);
    padding: var(--space-2);
    border-radius: var(--radius-md);
    background: rgba(0, 0, 0, 0.04);
    display: flex;
    flex-direction: column;
    gap: var(--space-2);

    &__actions {
        display: flex;
        justify-content: flex-end;
        gap: var(--space-1);
    }
}

.rkanboard-drop-zone {
    border: 1px dashed transparent;
    border-radius: var(--radius-md);
    padding: var(--space-2);
    text-align: center;
    color: var(--text-muted);
    font-size: 0.65rem;
    transition: border-color var(--transition-colors), background-color var(--transition-colors), color var(--transition-colors);

    &.is-active {
        border-color: var(--rkanboard-accent);
        background: rgba(var(--rkanboard-accent-rgb), 0.06);
        color: var(--rkanboard-accent);
    }
}

.rkanboard-drop-indicator {
    height: 4px;
    border-radius: 4px;
    background: var(--rkanboard-accent);
    margin: -4px 0 var(--space-2);
    opacity: 0.5;
}

.rkanboard-assignee {
    border-top: 1px solid rgba(0, 0, 0, 0.06);
    padding-top: var(--space-2);
    display: flex;
    flex-direction: column;
    gap: var(--space-2);

    &-avatar {
        width: 32px;
        height: 32px;
        border-radius: 999px;
        object-fit: cover;
        background: var(--surface-muted);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        color: var(--text-muted);

        &.placeholder {
            background: var(--surface-muted);
            border: 1px solid rgba(0, 0, 0, 0.08);
        }
    }

    &-picker {
        min-width: 200px;
    }

    &-item {
        padding: var(--space-2);
        border-radius: var(--radius-sm);
        transition: background-color var(--transition-colors);

        &:hover {
            background-color: rgba(0, 0, 0, 0.04);
        }
    }
}

.rkanboard-hidden-columns {
    .rbutton {
        --button-padding-x: var(--space-2);
        --button-padding-y: var(--space-1);
    }
}

.rkanboard-drop-indicator,
.rkanboard-column.is-drop-target,
.rkanboard-card.is-focused {
    transition: all var(--transition-colors);
}
