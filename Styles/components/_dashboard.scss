@use '../abstracts' as *;

.r-dashboard {
  display: grid;
  grid-template-columns: repeat(var(--r-dashboard-columns, 6), minmax(0, 1fr));
  grid-auto-rows: minmax(var(--r-dashboard-row-height, 120px), auto);
  gap: var(--r-dashboard-gap, var(--space-4));
  width: 100%;
  position: relative;
  align-items: stretch;

  &--dense {
    grid-auto-flow: dense;
  }

  &--relaxed {
    grid-auto-flow: row;
  }

  &--editing {
    .r-widget {
      cursor: grab;
      user-select: none;

      &__drag-handle {
        opacity: 1;
        pointer-events: auto;
      }

      &__resize-handle {
        opacity: 1;
        pointer-events: auto;
      }
    }
  }

  &__empty {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: var(--color-text-muted);
    gap: var(--space-2);
    border: 1px dashed var(--color-border);
    border-radius: var(--radius-xl);
    background: color-mix(in srgb, var(--color-surface) 80%, transparent);
    pointer-events: none;

    &-icon {
      font-size: var(--text-3xl);
    }

    &-text {
      font-size: var(--text-sm);
      text-align: center;
      max-width: 420px;
    }
  }
}

@media (min-width: 1280px) {
  .r-dashboard {
    grid-template-columns: repeat(var(--r-dashboard-columns-xl, var(--r-dashboard-columns, 6)), minmax(0, 1fr));
  }
}

@media (min-width: 1024px) and (max-width: 1279px) {
  .r-dashboard {
    grid-template-columns: repeat(var(--r-dashboard-columns-lg, var(--r-dashboard-columns, 5)), minmax(0, 1fr));
  }
}

@media (min-width: 768px) and (max-width: 1023px) {
  .r-dashboard {
    grid-template-columns: repeat(var(--r-dashboard-columns-md, 4), minmax(0, 1fr));
  }
}

@media (min-width: 640px) and (max-width: 767px) {
  .r-dashboard {
    grid-template-columns: repeat(var(--r-dashboard-columns-sm, 2), minmax(0, 1fr));
  }
}

@media (max-width: 639px) {
  .r-dashboard {
    grid-template-columns: repeat(var(--r-dashboard-columns-xs, 1), minmax(0, 1fr));
  }
}

.r-widget {
  @extend %component-base;
  position: relative;
  display: flex;
  flex-direction: column;
  min-width: 0;
  min-height: 100%;
  background: var(--color-surface-elevated);
  border: 1px solid var(--color-border-subtle);
  border-radius: var(--radius-xl);
  box-shadow: var(--shadow-sm);
  transition: box-shadow var(--duration-fast) var(--ease-out),
              transform var(--duration-fast) var(--ease-out);

  &__surface {
    display: flex;
    flex-direction: column;
    height: 100%;
    padding: var(--space-4);
    gap: var(--space-3);
  }

  &__header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: var(--space-3);
  }

  &__header-main {
    display: flex;
    align-items: center;
    gap: var(--space-2);
  }

  &__header-titles {
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
  }

  &__icon {
    color: var(--color-primary);
  }

  &__title {
    font-size: var(--text-lg);
    font-weight: var(--weight-semibold);
    color: var(--color-text-strong);
  }

  &__subtitle {
    font-size: var(--text-sm);
    color: var(--color-text-muted);
  }

  &__toolbar {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
  }

  &__body {
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
    flex: 1 1 auto;
  }

  &__footer {
    margin-top: auto;
    padding-top: var(--space-2);
    display: flex;
    justify-content: flex-end;
    gap: var(--space-2);
  }

  &__drag-handle {
    position: absolute;
    top: var(--space-2);
    right: var(--space-2);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 2rem;
    height: 2rem;
    border-radius: var(--radius-full);
    border: 1px solid var(--color-border-subtle);
    background: color-mix(in srgb, var(--color-surface) 75%, transparent);
    color: var(--color-text-muted);
    opacity: 0;
    pointer-events: none;
    transition: opacity var(--duration-fast) var(--ease-out);

    &:focus-visible {
      outline: 2px solid var(--color-primary);
      outline-offset: 2px;
    }
  }

  &__resize-handle {
    position: absolute;
    bottom: var(--space-2);
    right: var(--space-2);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 2rem;
    height: 2rem;
    border-radius: var(--radius-full);
    border: 1px solid var(--color-border-subtle);
    background: color-mix(in srgb, var(--color-surface) 75%, transparent);
    color: var(--color-text-muted);
    cursor: nwse-resize;
    opacity: 0;
    pointer-events: none;
    transition: opacity var(--duration-fast) var(--ease-out);
  }

  &:hover {
    box-shadow: var(--shadow-md);

    &__drag-handle,
    &__resize-handle {
      opacity: 1;
    }
  }

  &--editing {
    box-shadow: var(--shadow-lg);
  }

  &--dragging {
    z-index: 40;
    box-shadow: var(--shadow-xl);
    cursor: grabbing;
  }

  &--drop-target {
    outline: 2px dashed var(--color-primary);
    outline-offset: var(--space-1);
  }

  &--resize-locked {
    .r-widget__resize-handle {
      display: none;
    }
  }

  &--reorder-locked {
    .r-widget__drag-handle {
      display: none;
    }
  }
}

.r-chart-widget {
  &__summary {
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
  }

  &__metrics {
    display: grid;
    gap: var(--space-3);
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  }

  &__metric {
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
    padding: var(--space-2);
    border-radius: var(--radius-lg);
    background: color-mix(in srgb, var(--color-surface) 85%, transparent);
    border: 1px solid var(--color-border-subtle);
  }

  &__metric-label {
    font-size: var(--text-xs);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--color-text-muted);
  }

  &__metric-value {
    display: flex;
    align-items: baseline;
    gap: var(--space-1);
    font-size: var(--text-xl);
    font-weight: var(--weight-semibold);
    color: var(--color-text-strong);
  }

  &__metric-trend {
    display: inline-flex;
    align-items: center;
    gap: var(--space-0-5);
    font-size: var(--text-xs);
    font-weight: var(--weight-medium);
    padding: var(--space-0-5) var(--space-1);
    border-radius: var(--radius-lg);

    &--positive {
      color: var(--color-success-strong);
      background: color-mix(in srgb, var(--color-success) 18%, transparent);
    }

    &--negative {
      color: var(--color-error-strong);
      background: color-mix(in srgb, var(--color-error) 18%, transparent);
    }

    &--neutral {
      color: var(--color-text-muted);
      background: color-mix(in srgb, var(--color-surface) 70%, transparent);
    }
  }

  &__primary-metric {
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
    padding: var(--space-2);
    border-radius: var(--radius-xl);
    background: color-mix(in srgb, var(--color-primary) 12%, transparent);
    border: 1px solid color-mix(in srgb, var(--color-primary) 25%, transparent);
    color: var(--color-text-strong);
  }

  &__primary-label {
    font-size: var(--text-xs);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: color-mix(in srgb, var(--color-primary-strong) 65%, var(--color-text-muted) 35%);
  }

  &__primary-value {
    font-size: var(--text-2xl);
    font-weight: var(--weight-bold);
  }

  &__primary-trend {
    display: inline-flex;
    align-items: center;
    gap: var(--space-1);
    font-size: var(--text-sm);
    font-weight: var(--weight-medium);
    border-radius: var(--radius-lg);
    padding: var(--space-0-5) var(--space-1-5);

    &--positive {
      color: var(--color-success-strong);
      background: color-mix(in srgb, var(--color-success) 15%, transparent);
    }

    &--negative {
      color: var(--color-error-strong);
      background: color-mix(in srgb, var(--color-error) 15%, transparent);
    }

    &--neutral {
      color: var(--color-text-muted);
      background: color-mix(in srgb, var(--color-surface) 65%, transparent);
    }
  }

  &__chart {
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;
    min-height: 180px;

    &--with-summary {
      margin-top: var(--space-2);
    }

    .chart-container-content {
      flex: 1 1 auto;
    }
  }

  &__loading-state {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 120px;
    color: var(--color-text-muted);
  }
}
