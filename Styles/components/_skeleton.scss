@use '../abstracts' as *;
@use '../abstracts/mixins/design-modes' as design;
@use '../abstracts/mixins/density' as density;

// Skeleton color variables with proper theming
:root {
  --skeleton-bg: #e2e8f0;
  --skeleton-shimmer-light: #f8fafc;
}

[data-theme="dark"] {
  --skeleton-bg: #2d3748;
  --skeleton-shimmer-light: #4a5568;
}

// Base skeleton mixin
@mixin skeleton-base() {
  display: block;
  background: var(--skeleton-bg) !important;
  border-radius: var(--radius-sm);
  color: transparent !important;
  user-select: none;
  overflow: hidden;
  border: none !important;
  box-shadow: none !important;
  position: relative;
}

// Main skeleton class
.skeleton {
  @include skeleton-base();
  
  // Force gray background for all child elements
  * {
    color: transparent !important;
    background: transparent !important;
    border: none !important;
  }

  // Specific skeleton types
  &-text {
    @include skeleton-base();
    height: 14px;
    margin-bottom: 4px;
    border-radius: 3px;
    
    &:last-child {
      margin-bottom: 0;
    }
  }

  &-title {
    @include skeleton-base();
    height: 20px;
    margin-bottom: 8px;
    border-radius: 4px;
  }

  &-caption {
    @include skeleton-base();
    height: 12px;
    margin-bottom: 4px;
    border-radius: 3px;
    opacity: 0.8;
  }

  &-avatar {
    @include skeleton-base();
    width: 48px;
    height: 48px;
    border-radius: 50% !important;
    flex-shrink: 0;
  }

  &-icon-circle {
    @include skeleton-base();
    width: 32px;
    height: 32px;
    border-radius: 50% !important;
    flex-shrink: 0;
  }

  &-icon {
    @include skeleton-base();
    width: 24px;
    height: 24px;
    border-radius: 4px;
  }

  &-button {
    @include skeleton-base();
    min-width: 80px;
    height: 36px;
    border-radius: 6px;
  }

  &-badge {
    @include skeleton-base();
    height: 24px;
    min-width: 50px;
    border-radius: 12px !important;
    display: inline-block;
  }

  &-input {
    @include skeleton-base();
    width: 100%;
    height: 36px;
    border-radius: var(--radius-md);
  }

  &-card {
    @include skeleton-base();
    width: 100%;
    min-height: 120px;
    border-radius: var(--radius-lg);
    padding: var(--space-4);
  }

  &-table {
    @include skeleton-base();
    width: 100%;
    
    .skeleton-row {
      height: 48px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      padding: var(--space-3);
    }
  }

  // Smart skeleton wrapper
  &-smart {
    &-wrapper {
      position: relative;
      display: block;
      width: 100%;
      min-height: inherit;
    }

    &-container {
      display: block;
      
      &.skeleton-hidden-container {
        position: absolute;
        visibility: hidden;
        opacity: 0;
        pointer-events: none;
        height: 0;
        overflow: hidden;
        top: 0;
        left: 0;
        right: 0;
      }
    }

    &-overlay {
      position: relative;
      z-index: 1;
      display: block;
      width: 100%;
      min-height: 3rem;
      
      // Glass effect variant
      &.skeleton-glass {
        @include design.design-glass(primary, light);
        padding: var(--space-4);
        border-radius: var(--radius-lg);
        backdrop-filter: blur(10px);
        
        // Ensure skeletons are visible on glass
        .skeleton {
          background: rgba(0, 0, 0, 0.1) !important;
        }
        
        [data-theme="dark"] & {
          .skeleton {
            background: rgba(255, 255, 255, 0.1) !important;
          }
        }
      }
    }

    &-auto {
      display: block;
      width: 100%;
      
      // Direct skeleton children styling
      > .skeleton {
        margin-bottom: var(--space-2);
        
        &:last-child {
          margin-bottom: 0;
        }
      }
    }
  }

  // Animation classes
  &-shimmer {
    position: relative;
    overflow: hidden;
    
    &::after {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      background: linear-gradient(
        90deg,
        transparent 0%,
        var(--skeleton-shimmer-light) 50%,
        transparent 100%
      );
      animation: shimmer 2s ease-in-out infinite;
      transform: translateX(-100%);
    }
  }

  &-pulse {
    animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }
}

// Animation keyframes
@keyframes shimmer {
  0% {
    transform: translateX(-100%);
  }
  100% {
    transform: translateX(100%);
  }
}

@keyframes pulse {
  0%, 100% {
    opacity: 1;
  }
  50% {
    opacity: 0.5;
  }
}

// Accessibility - reduce motion
@media (prefers-reduced-motion: reduce) {
  .skeleton {
    &-shimmer::after,
    &-pulse {
      animation: none !important;
    }
  }
}

// High contrast mode
@media (prefers-contrast: high) {
  .skeleton {
    background: repeating-linear-gradient(
      45deg,
      var(--skeleton-bg),
      var(--skeleton-bg) 10px,
      var(--skeleton-shimmer-light) 10px,
      var(--skeleton-shimmer-light) 20px
    ) !important;
    
    &-shimmer::after {
      display: none;
    }
  }
}

// Utility classes for skeleton layouts
.skeleton-group {
  display: flex;
  flex-direction: column;
  gap: var(--space-2);
  
  &-horizontal {
    flex-direction: row;
    align-items: center;
  }
}

.skeleton-list {
  > * {
    margin-bottom: var(--space-3);
    
    &:last-child {
      margin-bottom: 0;
    }
  }
}

// Force skeleton visibility when debugging
.skeleton-debug {
  .skeleton-smart-container {
    visibility: visible !important;
    opacity: 0.3 !important;
    height: auto !important;
    position: relative !important;
    border: 2px dashed red !important;
  }
}