@use '../abstracts' as *;

.dropdown {
  position: relative;
  
  &__trigger {
    background: none;
    border: none;
    margin: 0;
    padding: 0;
    cursor: pointer;
    transition: var(--transition-colors);
    width: 100%;
    text-align: left;
    
    &:hover {
      opacity: 0.8;
    }
    
    &:focus {
      outline: var(--border-2) solid var(--color-interactive-focus);
      outline-offset: var(--border-2);
      border-radius: var(--radius-sm);
    }
  }
  
  &__viewport {
    position: absolute;
    left: 0;
    right: 0;
    z-index: var(--z-dropdown);
  }
  
  &__content {
    background: var(--color-background-elevated);
    border: var(--border-1) solid var(--color-border-light);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-lg);
    min-width: var(--container-xs);
    max-width: min(400px, 90vw);
    max-height: min(400px, 40vh);
    overflow-y: auto;
    width: max-content;
  }
  
  // BOTTOM positioning - below trigger (default)
  &--bottom {
    .dropdown__viewport {
      top: calc(100% + #{var(--space-2)});
    }
  }
  
  // TOP positioning - above trigger
  &--top {
    .dropdown__viewport {
      top: calc(-100% - #{var(--space-3)});
    }
  }
  
  // AUTO positioning - CSS-only smart positioning  
  &--auto {
    .dropdown__viewport {
      // Default: position below
      top: calc(100% + #{var(--space-2)});
      
      // Simple viewport detection: if trigger is in bottom 40% of screen, show above
      @media (max-height: 800px) {
        top: calc(-250px - #{var(--space-3)});
      }
      
      // For very small screens, always show above
      @media (max-height: 600px) {
        top: calc(-200px - #{var(--space-3)});
      }
    }
  }
  
  &__header,
  &__footer {
    padding: var(--space-3) var(--space-4);
    background: var(--color-background-secondary);
    border-bottom: var(--border-1) solid var(--color-border-light);
    font-size: var(--text-sm);
    font-weight: var(--font-medium);
    color: var(--color-text-primary);
  }
  
  &__footer {
    border-bottom: none;
    border-top: var(--border-1) solid var(--color-border-light);
  }
  
  &__loading {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-2);
    padding: var(--space-4);
    color: var(--color-text-secondary);
    font-size: var(--text-sm);
  }
  
  &__item {
    background: none;
    border: none;
    margin: 0;
    padding: 0;
    display: block;
    width: 100%;
    padding: var(--space-3) var(--space-4);
    text-align: left;
    color: var(--color-text-secondary);
    transition: var(--transition-colors);
    
    &:hover {
      background: var(--color-background-elevated);
      color: var(--color-text-primary);
    }
    
    &--active {
      background: var(--color-interactive-primary);
      color: var(--color-neutral-white);
    }
  }
  
  &__separator {
    height: var(--border-1);
    background: var(--color-border-light);
    margin: var(--space-2) 0;
  }
}

// Backdrop for dropdown outside click detection
.dropdown-backdrop {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: calc(var(--z-dropdown) - 1);
  background: transparent;
  cursor: default;
}