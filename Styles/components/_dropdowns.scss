@use '../abstracts' as *;

.dropdown {
  position: relative;
  
  &__trigger {
    background: var(--color-background-elevated);
    border: var(--border-1) solid var(--color-border-light);
    border-radius: var(--radius-md);
    margin: 0;
    padding: var(--space-3) var(--space-4);
    cursor: pointer;
    transition: all var(--duration-normal) var(--ease-out);
    width: 100%;
    text-align: left;
    position: relative;
    overflow: hidden;
    
    // Add dropdown indicator
    &::after {
      content: 'expand_more';
      font-family: 'Material Symbols Rounded';
      position: absolute;
      right: var(--space-3);
      top: 50%;
      transform: translateY(-50%);
      transition: transform var(--duration-normal) var(--ease-out);
      font-size: var(--icon-base);
      color: var(--color-text-secondary);
    }
    
    &--open::after {
      transform: translateY(-50%) rotate(180deg);
    }
    
    &:hover:not(:disabled) {
      border-color: var(--color-border-medium);
      box-shadow: var(--shadow-sm);
      transform: translateY(-1px);
    }
    
    &:focus:not(:disabled) {
      outline: var(--border-2) solid var(--color-interactive-focus);
      outline-offset: var(--border-1);
      border-color: var(--color-interactive-primary);
    }
    
    &:disabled {
      opacity: var(--opacity-disabled);
      cursor: not-allowed;
      
      &:hover {
        transform: none;
        box-shadow: none;
        border-color: var(--color-border-light);
      }
    }
  }
  
  &__viewport {
    position: absolute;
    left: 0;
    right: 0;
    z-index: var(--z-dropdown);
  }
  
  &__content {
    background: var(--color-background-elevated);
    border: var(--border-1) solid var(--color-border-light);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-xl);
    backdrop-filter: blur(16px);
    min-width: 20rem;
    max-width: min(400px, 90vw);
    max-height: min(400px, 40vh);
    overflow-y: auto;
    width: max-content;
    animation: dropdownSlideIn var(--duration-normal) var(--ease-out);
    
    // Modern glassmorphism effect
    @supports (backdrop-filter: blur(var(--blur-lg))) {
      background: color-mix(in srgb, var(--color-background-elevated) 85%, transparent);
    }
    
    // Custom scrollbar
    &::-webkit-scrollbar {
      width: var(--space-1);
    }
    
    &::-webkit-scrollbar-track {
      background: transparent;
    }
    
    &::-webkit-scrollbar-thumb {
      background: var(--color-border-medium);
      border-radius: var(--radius-sm);
      
      &:hover {
        background: var(--color-border-strong);
      }
    }
  }
  
  // Animation for top positions
  &--top &__content,
  &--topend &__content,
  &--topstart &__content,
  &--position-above &__content {
    animation: dropdownSlideUp var(--duration-normal) var(--ease-out);
  }
  
  // Animation for bottom positions
  &--position-below &__content {
    animation: dropdownSlideIn var(--duration-normal) var(--ease-out);
  }
  
  // BOTTOM positioning - below trigger (default)
  &--bottom {
    .dropdown__viewport {
      top: calc(100% + #{var(--space-2)});
    }
  }
  
  // TOP positioning - above trigger
  &--top {
    .dropdown__viewport {
      bottom: calc(100% + #{var(--space-2)});
      top: auto;
    }
  }
  
  // TOP END positioning - above trigger, aligned to end
  &--topend {
    .dropdown__viewport {
      bottom: calc(100% + #{var(--space-2)});
      top: auto;
      left: auto;
      right: 0;
    }
  }
  
  // TOP START positioning - above trigger, aligned to start
  &--topstart {
    .dropdown__viewport {
      bottom: calc(100% + #{var(--space-2)});
      top: auto;
      left: 0;
      right: auto;
    }
  }
  
  // BOTTOM END positioning - below trigger, aligned to end
  &--bottomend {
    .dropdown__viewport {
      top: calc(100% + #{var(--space-2)});
      left: auto;
      right: 0;
    }
  }
  
  // BOTTOM START positioning - below trigger, aligned to start
  &--bottomstart {
    .dropdown__viewport {
      top: calc(100% + #{var(--space-2)});
      left: 0;
      right: auto;
    }
  }
  
  // AUTO positioning - CSS-only smart positioning  
  &--auto {
    .dropdown__viewport {
      // Default: position below
      top: calc(100% + #{var(--space-2)});
      
      // Simple viewport detection: if trigger is in bottom 40% of screen, show above
      @media (max-height: 800px) {
        top: calc(-250px - #{var(--space-3)});
      }
      
      // For very small screens, always show above
      @media (max-height: 600px) {
        top: calc(-200px - #{var(--space-3)});
      }
    }
  }
  
  &__header,
  &__footer {
    padding: var(--space-3) var(--space-4);
    background: var(--color-background-secondary);
    border-bottom: var(--border-1) solid var(--color-border-light);
    font-size: var(--text-sm);
    font-weight: var(--font-medium);
    color: var(--color-text-primary);
  }
  
  &__footer {
    border-bottom: none;
    border-top: var(--border-1) solid var(--color-border-light);
  }
  
  &__loading {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-2);
    padding: var(--space-4);
    color: var(--color-text-secondary);
    font-size: var(--text-sm);
  }
  
  &__item {
    background: none;
    border: none;
    margin: var(--space-1) var(--space-2);
    padding: 0;
    display: flex;
    align-items: center;
    gap: var(--space-3);
    width: calc(100% - #{var(--space-4)});
    padding: var(--space-3) var(--space-3);
    text-align: left;
    color: var(--color-text-secondary);
    transition: all var(--duration-normal) var(--ease-out);
    cursor: pointer;
    position: relative;
    border-radius: var(--radius-md);
    
    // Icon styling
    i {
      font-size: var(--icon-base);
      width: var(--icon-base);
      flex-shrink: 0;
    }
    
    // Text styling
    span {
      flex: 1;
      font-size: var(--text-sm);
      font-weight: var(--font-medium);
      line-height: 1.4;
    }
    
    &:hover:not(&--disabled) {
      background: var(--color-interactive-light);
      color: var(--color-text-primary);
      transform: translateX(var(--space-px));
      box-shadow: var(--shadow-sm);
    }
    
    &--active {
      background: var(--color-interactive-primary);
      color: var(--color-text-inverse);
      font-weight: var(--font-semibold);
      box-shadow: var(--shadow-sm);
      
      &::before {
        content: '';
        position: absolute;
        left: 0;
        top: 50%;
        transform: translateY(-50%);
        width: var(--space-1);
        height: 60%;
        background: var(--color-text-inverse);
        border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
      }
      
      &:hover {
        background: var(--color-interactive-hover);
        transform: translateX(var(--space-px));
      }
    }
    
    &--disabled {
      opacity: var(--opacity-disabled);
      cursor: not-allowed;
      
      &:hover {
        background: none;
        color: var(--color-text-secondary);
        transform: none;
        box-shadow: none;
      }
    }
    
    // Check icon alignment
    > i:last-child {
      margin-left: auto;
      opacity: var(--opacity-disabled);
    }
  }
  
  &__separator {
    height: var(--border-1);
    background: var(--color-border-light);
    margin: var(--space-2) 0;
  }
}

// Backdrop for dropdown outside click detection
.dropdown-backdrop {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: calc(var(--z-dropdown) - 1);
  background: transparent;
  cursor: default;
}