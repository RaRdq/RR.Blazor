@** 
<summary>Professional checkbox component with enterprise styling and accessibility</summary>
<category>Form</category>
<complexity>Simple</complexity>
<ai-prompt>Create a modern checkbox for user selections with professional styling</ai-prompt>
<ai-common-use>form selections, multi-select lists, permission toggles, settings</ai-common-use>
<ai-avoid>Don't use for binary toggle switches (use RChoice) or single selections (use RRadio)</ai-avoid>
<ai-pattern name="basic-checkbox">Text="Accept Terms" @bind-Checked="acceptTerms"</ai-pattern>
<ai-pattern name="with-description">Text="Enable Notifications" Description="Receive email updates" @bind-Checked="notifications"</ai-pattern>
<ai-pattern name="disabled-state">Text="Premium Feature" Disabled="true" Description="Upgrade required"</ai-pattern>
<ai-pattern name="validation-error">Text="Required Field" @bind-Checked="required" ValidationMessage="This field is required"</ai-pattern>
<ai-pattern name="with-icon">Text="Important Item" Icon="star" @bind-Checked="starred"</ai-pattern>
**@

@attribute [Component("RCheckbox", Category = "Form")]
@attribute [AIOptimized(Prompt = "Create professional checkbox with validation")]

@using RR.Blazor.Enums
@using RR.Blazor.Models
@using RR.Blazor.Components.Base
@using RR.Blazor.Utilities
@inherits RR.Blazor.Components.Base.RInteractiveComponentBase

<div class="@GetContainerClasses()">
    <input type="checkbox" 
           id="@Id"
           name="@Name"
           checked="@Checked"
           @onchange="HandleCheckboxChange"
           disabled="@Disabled"
           required="@Required"
           data-field="@Name"
           class="peer absolute opacity-0 cursor-pointer disabled:cursor-not-allowed z-10 w-full h-full top-0 left-0"
           @attributes="GetSafeAttributes()" />
    
    <div class="@GetCheckboxClasses()">
        <i class="icon @GetCheckIconClasses()">check</i>
    </div>
    
    @if (!string.IsNullOrEmpty(Text) || !string.IsNullOrEmpty(Description) || !string.IsNullOrEmpty(Icon))
    {
        <label for="@Id" class="@GetLabelClasses()">
            <div class="@GetTextContainerClasses()">
                @if (!string.IsNullOrEmpty(Icon))
                {
                    <i class="icon @GetIconClasses()">@Icon</i>
                }
                @if (!string.IsNullOrEmpty(Text))
                {
                    <span class="@GetTextClasses()">@Text</span>
                }
                @if (Required)
                {
                    <span class="@GetRequiredClasses()">*</span>
                }
            </div>
            @if (!string.IsNullOrEmpty(Description))
            {
                <div class="@GetDescriptionClasses()">@Description</div>
            }
        </label>
    }
    
    @if (ChildContent != null)
    {
        <div class="grow">
            @ChildContent
        </div>
    }
</div>

@if (HasError && !string.IsNullOrEmpty(ErrorMessage))
{
    <div class="@GetValidationClasses()">
        <i class="icon text-error mr-1">error</i>
        @ErrorMessage
    </div>
}

@code {
    /// <summary>Unique identifier for the checkbox input</summary>
    [Parameter] public string Id { get; set; } = $"checkbox-{Guid.NewGuid():N}";
    
    /// <summary>Name attribute for form submission</summary>
    [Parameter] public string? Name { get; set; }
    
    /// <summary>Whether the checkbox is checked</summary>
    [Parameter] public bool Checked { get; set; }
    
    /// <summary>Callback when checked state changes</summary>
    [Parameter] public EventCallback<bool> CheckedChanged { get; set; }
    
    /// <summary>Label text for the checkbox</summary>
    [Parameter] public string? Text { get; set; }
    
    /// <summary>Description text shown below the label</summary>
    [Parameter] public string? Description { get; set; }
    
    /// <summary>Icon displayed next to the text</summary>
    [Parameter] public string? Icon { get; set; }
    
    /// <summary>Visual style variant of the checkbox</summary>
    [Parameter] public CheckboxVariant Variant { get; set; } = CheckboxVariant.Default;
    
    /// <summary>Size of the checkbox</summary>
    [Parameter] public SizeType Size { get; set; } = SizeType.Medium;
    
    
    
    /// <summary>Whether the checkbox is required</summary>
    [Parameter] public bool Required { get; set; }
    
    /// <summary>Whether the checkbox has an error</summary>
    [Parameter] public bool HasError { get; set; }
    
    /// <summary>Error message to display</summary>
    [Parameter] public string? ErrorMessage { get; set; }
    
    

    private async Task HandleCheckboxChange(ChangeEventArgs e)
    {
        var newValue = e.Value is bool boolValue ? boolValue : false;
        Checked = newValue;
        StateHasChanged();
        await CheckedChanged.InvokeAsync(Checked);
        if (OnClick.HasDelegate)
        {
            await OnClick.InvokeAsync(new MouseEventArgs());
        }
    }

    


    private string GetContainerClasses()
    {
        var classes = new List<string> { "checkbox" };
        
        if (Disabled)
            classes.Add("checkbox-disabled");
            
        classes.Add(DensityHelper.BuildDensityClasses("checkbox", Density));
            
        if (!string.IsNullOrEmpty(Class))
            classes.Add(Class);

        return string.Join(" ", classes);
    }

    private string GetCheckboxClasses()
    {
        var classes = new List<string> { "checkbox-mark" };

        if (Variant != CheckboxVariant.Default)
        {
            var variantName = Variant == CheckboxVariant.Danger ? "error" : Variant.ToString().ToLower();
            classes.Add($"checkbox-mark-{variantName}");
        }

        if (Size != SizeType.Medium)
        {
            classes.Add($"checkbox-mark-{Size.ToString().ToLower()}");
        }

        return string.Join(" ", classes);
    }

    private string GetInputClasses()
    {

        return "";
    }

    private string GetCheckIconClasses()
    {
        return "checkbox-icon";
    }

    private string GetLabelClasses()
    {
        var classes = new List<string> { "checkbox-label" };
        
        if (Disabled)
            classes.Add("checkbox-label-disabled");
            
        return string.Join(" ", classes);
    }

    private string GetTextContainerClasses()
    {
        return "checkbox-content";
    }

    private string GetIconClasses()
    {
        return "checkbox-text-icon";
    }

    private string GetTextClasses()
    {
        return "checkbox-text";
    }

    private string GetRequiredClasses()
    {
        return "text-error ml-1";
    }

    private string GetDescriptionClasses()
    {
        return "checkbox-description";
    }

    /// <summary>
    /// Returns safely filtered HTML attributes using centralized RAttributeForwarder.
    /// </summary>
    private Dictionary<string, object> GetSafeAttributes()
    {
        return RAttributeForwarder.GetSafeAttributes(AdditionalAttributes);
    }

    private string GetValidationClasses()
    {
        return "validation-message";
    }

}