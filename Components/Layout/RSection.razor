@using RR.Blazor.Enums
@* RSection - Section wrapper with header/content areas using utility classes *@

<section class="section @GetSectionClasses()" 
         @onclick="HandleClick"
         role="@(IsCollapsible ? "button" : null)"
         aria-expanded="@(IsCollapsible ? (!IsCollapsed).ToString().ToLower() : null)"
         aria-controls="@(IsCollapsible ? $"section-content-{SectionId}" : null)"
         tabindex="@(IsCollapsible ? 0 : null)">
    
    @* Header *@
    @if (HasHeader)
    {
        <header class="section__header @GetHeaderClasses()" @onclick="HandleHeaderClick">
            @if (!string.IsNullOrEmpty(Title) || TitleContent != null)
            {
                <div class="section__title @GetTitleSectionClasses()">
                    @if (!string.IsNullOrEmpty(Icon))
                    {
                        <i class="material-symbols-rounded mr-3 @GetIconSizeClass()">@Icon</i>
                    }
                    
                    <div class="flex-grow-1">
                        @if (!string.IsNullOrEmpty(Title))
                        {
                            <h2 class="section__title @GetTitleClasses()">@Title</h2>
                        }
                        
                        @if (!string.IsNullOrEmpty(Subtitle))
                        {
                            <div class="section__subtitle">@Subtitle</div>
                        }
                        
                        @TitleContent
                    </div>
                    
                    @if (IsCollapsible)
                    {
                        <div class="ml-3 transition-transform @(IsCollapsed ? "" : "rotate-180")">
                            <i class="material-symbols-rounded text-secondary">expand_more</i>
                        </div>
                    }
                </div>
            }
            
        </header>
    }
    
    @* Content *@
    <div id="@(IsCollapsible ? $"section-content-{SectionId}" : "")" 
         class="section__content @GetContentClasses()">
        @ChildContent
    </div>
    
    @* Footer *@
    @if (FooterContent != null)
    {
        <footer class="section__footer @GetFooterClasses()">
            @FooterContent
        </footer>
    }
</section>

@code {
    /// <summary>Section identifier</summary>
    [Parameter] public string SectionId { get; set; } = Guid.NewGuid().ToString("N")[..8];
    
    /// <summary>Section title</summary>
    [Parameter] public string Title { get; set; }
    
    /// <summary>Section subtitle</summary>
    [Parameter] public string Subtitle { get; set; }
    
    /// <summary>Icon for header</summary>
    [Parameter] public string Icon { get; set; }
    
    /// <summary>Whether section is collapsible</summary>
    [Parameter] public bool IsCollapsible { get; set; }
    
    /// <summary>Whether section is collapsed (if collapsible)</summary>
    [Parameter] public bool IsCollapsed { get; set; }
    
    /// <summary>Callback when collapsed state changes</summary>
    [Parameter] public EventCallback<bool> IsCollapsedChanged { get; set; }
    
    
    /// <summary>Whether to remove header border</summary>
    [Parameter] public bool NoHeaderBorder { get; set; }
    
    /// <summary>Whether to remove footer border</summary>
    [Parameter] public bool NoFooterBorder { get; set; }
    
    /// <summary>Whether to remove content padding</summary>
    [Parameter] public bool NoPadding { get; set; }
    
    /// <summary>Additional CSS classes</summary>
    [Parameter] public string Class { get; set; }
    
    /// <summary>Main content</summary>
    [Parameter] public RenderFragment ChildContent { get; set; }
    
    /// <summary>Title content area</summary>
    [Parameter] public RenderFragment TitleContent { get; set; }
    
    /// <summary>Footer content area</summary>
    [Parameter] public RenderFragment FooterContent { get; set; }
    
    /// <summary>Section click event handler</summary>
    [Parameter] public EventCallback<MouseEventArgs> OnClick { get; set; }
    
    
    /// <summary>Collapse/expand event handler</summary>
    [Parameter] public EventCallback<bool> OnToggleCollapse { get; set; }
    
    private bool HasHeader => !string.IsNullOrEmpty(Title) || TitleContent != null;
    
    private string GetSectionClasses()
    {
        var classes = new List<string> { "d-flex", "flex-column" };
        
        if (IsCollapsible)
        {
            classes.Add("section--collapsible");
        }
        
        
        if (!string.IsNullOrEmpty(Class))
        {
            classes.Add(Class);
        }
        
        return string.Join(" ", classes);
    }
    
    private string GetHeaderClasses()
    {
        var classes = new List<string>
        {
            "d-flex",
            "align-center",
            "justify-between"
        };
        
        if (!NoHeaderBorder)
        {
            classes.AddRange(new[] { "pb-3", "border-b", "border-light" });
        }
        
        if (IsCollapsible)
        {
            classes.AddRange(new[] { "cursor-pointer", "user-select-none", "hover:bg-secondary", "rounded-md", "px-3", "py-2", "mx--3", "my--2" });
        }
        
        return string.Join(" ", classes);
    }
    
    private string GetTitleSectionClasses()
    {
        return "d-flex align-center flex-grow-1";
    }
    
    private string GetTitleClasses()
    {
        return "text-xl font-semibold text-primary mb-0";
    }
    
    private string GetContentClasses()
    {
        var classes = new List<string> { "flex-grow-1", "min-h-0" };
        
        if (IsCollapsible && IsCollapsed)
        {
            classes.Add("section__content--collapsed");
        }
        
        if (!NoPadding)
        {
            classes.Add("py-4");
        }
        
        return string.Join(" ", classes);
    }
    
    private string GetFooterClasses()
    {
        var classes = new List<string>
        {
            "d-flex",
            "align-center",
            "justify-between"
        };
        
        if (!NoFooterBorder)
        {
            classes.AddRange(new[] { "pt-3", "border-t", "border-light" });
        }
        
        return string.Join(" ", classes);
    }
    
    
    private string GetIconSizeClass()
    {
        return "text-lg";
    }
    
    private async Task HandleClick(MouseEventArgs e)
    {
        await OnClick.InvokeAsync(e);
    }
    
    private async Task HandleHeaderClick(MouseEventArgs e)
    {
        if (IsCollapsible)
        {
            IsCollapsed = !IsCollapsed;
            await IsCollapsedChanged.InvokeAsync(IsCollapsed);
            await OnToggleCollapse.InvokeAsync(IsCollapsed);
        }
    }
    
}

@* 
Usage Examples:

<!-- Basic section -->
<RSection Title="Basic Section">
    <div>Section content goes here...</div>
</RSection>

<!-- Section with subtitle and icon -->
<RSection Title="Settings" 
          Subtitle="Configure your preferences"
          Icon="settings">
    <div>Settings content...</div>
</RSection>

<!-- Section with header content (CLEAN API) -->
<RSection Title="User Management" Icon="people">
    <TitleContent>
        <div class="d-flex align-center gap-2 ml-4">
            <RButton Text="Add User" 
                     Variant="ButtonVariant.Primary" 
                     Size="ButtonSize.Small"
                     Icon="add" IconPosition="IconPosition.Start" />
            <RButton Variant="ButtonVariant.Ghost" 
                     Icon="more_vert" IconPosition="IconPosition.Start" 
                     Size="ButtonSize.Small" />
        </div>
    </TitleContent>
    <div>User list content...</div>
</RSection>

<!-- Collapsible section -->
<RSection Title="Advanced Options" 
          IsCollapsible="true"
          @bind-IsCollapsed="isCollapsed">
    <div>Collapsible content...</div>
</RSection>

<!-- Use composition with dedicated components -->
<RSection Title="Data Loading">
    <RSkeleton Count="3" Height="60px" />
</RSection>

<!-- Error with composition -->
<RSection Title="Failed Request">
    <div class="py-6 px-4 border border-error bg-error-light rounded-md">
        <div class="d-flex align-center">
            <i class="material-symbols-rounded text-error mr-3">error</i>
            <div>
                <div class="text-error font-medium">Network Error</div>
                <div class="text-secondary text-sm mt-1">Failed to fetch data from server</div>
                <div class="mt-3">
                    <RButton Text="Retry" 
                             Variant="ButtonVariant.Outline" 
                             Size="ButtonSize.Small"
                             Icon="refresh" IconPosition="IconPosition.Start"
                             OnClick="HandleRetry" />
                </div>
            </div>
        </div>
    </div>
</RSection>

<!-- Empty state with dedicated component -->
<RSection Title="Documents">
    <REmptyState Title="No documents found"
                 Description="Upload documents to get started"
                 Icon="description">
        <Actions>
            <RButton Text="Upload Document" 
                     Variant="ButtonVariant.Primary"
                     Icon="upload" IconPosition="IconPosition.Start" />
        </Actions>
    </REmptyState>
</RSection>

<!-- Section with footer -->
<RSection Title="Form Section">
    <div>Form content...</div>
    <FooterContent>
        <div class="d-flex align-center justify-end gap-2">
            <RButton Text="Cancel" Variant="ButtonVariant.Secondary" />
            <RButton Text="Save" Variant="ButtonVariant.Primary" />
        </div>
    </FooterContent>
</RSection>

<!-- No padding section -->
<RSection Title="Table Data" NoPadding="true">
    <table class="w-full">
        <!-- Table content -->
    </table>
</RSection>
*@