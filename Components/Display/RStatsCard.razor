@* RStatsCard - Generic dashboard statistics card component *@

@using RR.Blazor.Enums
@using RR.Blazor.Components.Base
@inherits RForwardingComponentBase

<div @attributes="GetSafeAttributes()">
<RCard Clickable="@Clickable" 
       OnClick="@OnClick"
       Elevation="@Elevation"
       Class="@($"d-flex items-center justify-center {GetDensityClasses()} {Class}")">
    <div class="@GetContentClasses() w-full">
        @if (!string.IsNullOrEmpty(Icon))
        {
            <div class="@GetIconContainerClasses() icon-container-dynamic" style="@GetIconStyle()">
                <i class="material-symbols-rounded">@Icon</i>
            </div>
        }
        <div class="grow">
            <div class="@GetTextClasses()">@Text</div>
            <div class="@GetValueContainerClasses()">
                <span class="@GetValueClasses() value-dynamic" style="@GetValueStyle()">@Value</span>
                @if (!string.IsNullOrEmpty(BadgeText))
                {
                    <RChip Text="@BadgeText" Style="ChipStyle.Badge" Variant="@BadgeVariant" Size="@GetBadgeSize()" />
                }
            </div>
            @if (!string.IsNullOrEmpty(Subtitle))
            {
                <div class="@GetSubtitleClasses()">@Subtitle</div>
            }
        </div>
    </div>
</RCard>
</div>

@code {
    /// <summary>
    /// Card label text (displayed above the value)
    /// </summary>
    [Parameter] 
    [AIParameter("Text displayed as card title", Example = "Monthly Revenue")] 
    public string Text { get; set; } = string.Empty;

    /// <summary>
    /// Main value to display
    /// </summary>
    [Parameter]
    [AIParameter(Hint = "Primary statistic value to display prominently", Example = "$156,780", IsRequired = true)]
    public string Value { get; set; } = string.Empty;

    /// <summary>
    /// Optional subtitle text (displayed below the value)
    /// </summary>
    [Parameter]
    [AIParameter(Hint = "Secondary text displayed below the main value", Example = "vs. last month")]
    public string Subtitle { get; set; } = string.Empty;

    /// <summary>
    /// Material Icons icon name
    /// </summary>
    [Parameter]
    [AIParameter(Hint = "Material Icons name for visual representation", SuggestedValues = new[] { "trending_up", "attach_money", "people", "analytics", "shopping_cart" }, Example = "trending_up")]
    public string Icon { get; set; } = string.Empty;

    /// <summary>
    /// Icon background color (semantic color name without var prefix)
    /// </summary>
    [Parameter]
    [AIParameter(Hint = "Semantic color name for icon background", SuggestedValues = new[] { "interactive-primary", "success", "warning", "error", "info" }, Example = "success")]
    public string IconColor { get; set; } = "interactive-primary";

    /// <summary>
    /// Value text color (semantic color name without var prefix)
    /// </summary>
    [Parameter]
    [AIParameter(Hint = "Semantic color name for value text", SuggestedValues = new[] { "interactive-primary", "success", "warning", "error", "text-primary" }, Example = "interactive-primary")]
    public string ValueColor { get; set; } = "interactive-primary";

    /// <summary>
    /// Icon size in pixels
    /// </summary>
    [Parameter]
    [AIParameter(Hint = "Icon container size in pixels", Example = "40")]
    public int IconSize { get; set; } = 40;

    /// <summary>
    /// Badge text to display next to the value
    /// </summary>
    [Parameter]
    [AIParameter(Hint = "Optional badge text shown next to value", Example = "+12%")]
    public string BadgeText { get; set; } = string.Empty;

    /// <summary>
    /// Badge variant
    /// </summary>
    [Parameter]
    [AIParameter(Hint = "Visual style for badge", SuggestedValues = new[] { "Info", "Success", "Warning", "Error" }, Example = "Success")]
    public ChipVariant BadgeVariant { get; set; } = ChipVariant.Info;

    /// <summary>
    /// Badge size
    /// </summary>
    [Parameter]
    [AIParameter(Hint = "Size of the badge component", SuggestedValues = new[] { "Small", "Medium", "Large" }, Example = "Small")]
    public BadgeSize BadgeSize { get; set; } = BadgeSize.Small;

    /// <summary>
    /// Whether the card is clickable
    /// </summary>
    [Parameter]
    [AIParameter(Hint = "Makes card interactive with hover effects and click events")]
    public bool Clickable { get; set; } = false;

    /// <summary>
    /// Click event handler
    /// </summary>
    [Parameter]
    [AIParameter(Hint = "Event fired when clickable card is clicked")]
    public EventCallback OnClick { get; set; }

    /// <summary>
    /// Card elevation level
    /// </summary>
    [Parameter]
    [AIParameter(Hint = "Shadow depth level for card elevation", SuggestedValues = new[] { "0", "1", "2", "3", "4" }, Example = "2")]
    public int Elevation { get; set; } = 2;

    /// <summary>
    /// Additional CSS classes
    /// </summary>
    [Parameter]
    [AIParameter(Hint = "Custom CSS classes for styling overrides", Example = "mb-4 custom-stats")]
    public string Class { get; set; } = string.Empty;
    
    /// <summary>
    /// Component density level for ultra-dense layouts
    /// </summary>
    [Parameter]
    [AIParameter(Hint = "Layout density affecting spacing and sizing", SuggestedValues = new[] { "Compact", "Dense", "Normal", "Spacious" }, Example = "Normal")]
    public ComponentDensity Density { get; set; } = ComponentDensity.Normal;
    
    private string GetDensityClasses() => Density switch
    {
        ComponentDensity.Compact => "pa-2",
        ComponentDensity.Dense => "pa-3",
        ComponentDensity.Normal => "pa-4",
        ComponentDensity.Spacious => "pa-6",
        _ => "pa-4"
    };
    
    private string GetContentClasses() => Density switch
    {
        ComponentDensity.Compact => "d-flex items-center gap-2",
        ComponentDensity.Dense => "d-flex items-center gap-2",
        ComponentDensity.Normal => "d-flex items-center gap-3",
        ComponentDensity.Spacious => "d-flex items-center gap-4",
        _ => "d-flex items-center gap-3"
    };
    
    private string GetIconContainerClasses() => Density switch
    {
        ComponentDensity.Compact => "rounded d-flex items-center justify-center",
        ComponentDensity.Dense => "rounded-md d-flex items-center justify-center",
        ComponentDensity.Normal => "rounded-lg d-flex items-center justify-center",
        ComponentDensity.Spacious => "rounded-xl d-flex items-center justify-center",
        _ => "rounded-lg d-flex items-center justify-center"
    };
    
    private int GetIconSize() => Density switch
    {
        ComponentDensity.Compact => 20,
        ComponentDensity.Dense => 24,
        ComponentDensity.Normal => 32,
        ComponentDensity.Spacious => 40,
        _ => 32
    };
    
    private string GetTextClasses() => Density switch
    {
        ComponentDensity.Compact => "text-xs font-medium uppercase mb-0 text-secondary tracking-wide",
        ComponentDensity.Dense => "text-xs font-medium uppercase mb-0 text-secondary tracking-wide",
        ComponentDensity.Normal => "text-xs font-medium uppercase mb-1 text-secondary tracking-wide",
        ComponentDensity.Spacious => "text-sm font-medium uppercase mb-2 text-secondary tracking-wide",
        _ => "text-xs font-medium uppercase mb-1 text-secondary tracking-wide"
    };
    
    private string GetValueContainerClasses() => Density switch
    {
        ComponentDensity.Compact => "d-flex items-center gap-1",
        ComponentDensity.Dense => "d-flex items-center gap-1",
        ComponentDensity.Normal => "d-flex items-center gap-2",
        ComponentDensity.Spacious => "d-flex items-center gap-3",
        _ => "d-flex items-center gap-2"
    };
    
    private string GetValueClasses() => Density switch
    {
        ComponentDensity.Compact => "text-sm font-bold",
        ComponentDensity.Dense => "text-base font-bold",
        ComponentDensity.Normal => "text-lg font-bold",
        ComponentDensity.Spacious => "text-xl font-bold",
        _ => "text-lg font-bold"
    };
    
    private string GetSubtitleClasses() => Density switch
    {
        ComponentDensity.Compact => "text-xs text-tertiary mt-0",
        ComponentDensity.Dense => "text-xs text-tertiary mt-0",
        ComponentDensity.Normal => "text-xs text-tertiary mt-0.5",
        ComponentDensity.Spacious => "text-sm text-tertiary mt-1",
        _ => "text-xs text-tertiary mt-0.5"
    };
    
    private ChipSize GetBadgeSize() => Density switch
    {
        ComponentDensity.Compact => ChipSize.Small,
        ComponentDensity.Dense => ChipSize.Small,
        ComponentDensity.Normal => ChipSize.Medium,
        ComponentDensity.Spacious => ChipSize.Large,
        _ => ChipSize.Medium
    };
    
    private string GetIconStyle()
    {
        var iconSize = GetIconSize();
        return $"--icon-size: {iconSize}px; --icon-color: var(--color-{IconColor}); --icon-font-size: {iconSize * 0.6}px;";
    }
    
    private string GetValueStyle()
    {
        return $"--value-color: var(--color-{ValueColor});";
    }

}