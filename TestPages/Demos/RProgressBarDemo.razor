@using RR.Blazor.Components.Core
@using RR.Blazor.Components.Display
@using RR.Blazor.Components.Feedback
@using RR.Blazor.Enums

<RCard Variant="CardVariant.Outlined" Text="RProgressBar">
    <ChildContent>
        <RDivider Text="Progress Bar Component" 
                         Subtitle="Visual progress indication for operations, uploads, and task completion" 
                         Icon="track_changes" />
        
        <div class="space-y-6">
            <!-- Basic Examples -->
            <div class="space-y-2">
                <div class="text-h6 font-semibold">Basic Examples</div>
                <div class="space-y-4">
                    <RProgressBar Value="30" Text="Basic Progress" />
                    <RProgressBar Value="65" Text="With Label" ShowLabel="true" />
                    <RProgressBar Value="85" Text="High Progress" ShowLabel="true" />
                    <RProgressBar Value="100" Text="Completed" ShowLabel="true" />
                </div>
            </div>

            <!-- Progress Variants -->
            <div class="space-y-2">
                <div class="text-h6 font-semibold">Progress Variants</div>
                <div class="space-y-4">
                    <RProgressBar Value="40" Text="Primary" Variant="ProgressVariant.Primary" />
                    <RProgressBar Value="60" Text="Success" Variant="ProgressVariant.Success" />
                    <RProgressBar Value="70" Text="Warning" Variant="ProgressVariant.Warning" />
                    <RProgressBar Value="85" Text="Error" Variant="ProgressVariant.Error" />
                    <RProgressBar Value="90" Text="Info" Variant="ProgressVariant.Info" />
                </div>
            </div>

            <!-- Sizes -->
            <div class="space-y-2">
                <div class="text-h6 font-semibold">Sizes</div>
                <div class="space-y-4">
                    <RProgressBar Value="45" Text="Small Progress" Size="SizeType.Small" />
                    <RProgressBar Value="65" Text="Medium Progress" Size="SizeType.Medium" />
                    <RProgressBar Value="85" Text="Large Progress" Size="SizeType.Large" />
                </div>
            </div>

            <!-- Density -->
            <div class="space-y-2">
                <div class="text-h6 font-semibold">Density Variants</div>
                <div class="space-y-4">
                    <RProgressBar Value="45" Text="Compact Density" Density="DensityType.Compact" />
                    <RProgressBar Value="65" Text="Dense Density" Density="DensityType.Dense" />
                    <RProgressBar Value="85" Text="Normal Density" Density="DensityType.Normal" />
                    <RProgressBar Value="95" Text="Spacious Density" Density="DensityType.Spacious" />
                </div>
            </div>

            <!-- Label Positions -->
            <div class="space-y-2">
                <div class="text-h6 font-semibold">Label Positions</div>
                <div class="space-y-4">
                    <RProgressBar Value="55" Text="Label Outside" ShowLabel="true" LabelInside="false" />
                    <RProgressBar Value="75" Text="Label Inside" ShowLabel="true" LabelInside="true" />
                    <RProgressBar Value="95" ShowLabel="true" LabelInside="true" />
                </div>
            </div>

            <!-- Indeterminate Progress -->
            <div class="space-y-2">
                <div class="text-h6 font-semibold">Indeterminate Progress</div>
                <div class="space-y-4">
                    <RProgressBar Text="Loading... (Right)" Indeterminate="true" Direction="Direction.Right" />
                    <RProgressBar Text="Processing... (Left)" Indeterminate="true" Variant="ProgressVariant.Success" Direction="Direction.Left" />
                    <RProgressBar Text="Syncing... (Up)" Indeterminate="true" Variant="ProgressVariant.Info" Direction="Direction.Up" />
                    <RProgressBar Text="Downloading... (Down)" Indeterminate="true" Variant="ProgressVariant.Warning" Direction="Direction.Down" />
                </div>
            </div>

            <!-- Direction Control Demo -->
            <div class="space-y-2">
                <div class="text-h6 font-semibold">Direction Control</div>
                <div class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <p class="text-sm text-muted mb-2">Horizontal Directions</p>
                            <div class="space-y-3">
                                <RProgressBar Text="Left to Right (Default)" Indeterminate="true" Direction="Direction.Right" />
                                <RProgressBar Text="Right to Left" Indeterminate="true" Variant="ProgressVariant.Success" Direction="Direction.Left" />
                            </div>
                        </div>
                        <div>
                            <p class="text-sm text-muted mb-2">Vertical Directions</p>
                            <div class="space-y-3">
                                <RProgressBar Text="Bottom to Top" Indeterminate="true" Variant="ProgressVariant.Info" Direction="Direction.Up" Size="SizeType.Large" />
                                <RProgressBar Text="Top to Bottom" Indeterminate="true" Variant="ProgressVariant.Warning" Direction="Direction.Down" Size="SizeType.Large" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Striped and Animated -->
            <div class="space-y-2">
                <div class="text-h6 font-semibold">Striped & Animated</div>
                <div class="space-y-4">
                    <RProgressBar Value="60" Text="Striped" Striped="true" />
                    <RProgressBar Value="70" Text="Animated" Animated="true" />
                    <RProgressBar Value="80" Text="Striped + Animated" Striped="true" Animated="true" />
                </div>
            </div>

            <!-- Professional Use Cases -->
            <div class="space-y-2">
                <div class="text-h6 font-semibold">Professional Use Cases</div>
                <div class="space-y-4">
                    <div>
                        <p class="text-sm text-muted mb-3">File Upload Progress</p>
                        <div class="space-y-3">
                            <RProgressBar Value="@_uploadProgress1" 
                                          Text="document.pdf" 
                                          Variant="ProgressVariant.Primary"
                                          ShowLabel="true"
                                          LabelFormat="{0}% uploaded" />
                            <RProgressBar Value="@_uploadProgress2" 
                                          Text="presentation.pptx" 
                                          Variant="ProgressVariant.Success"
                                          ShowLabel="true"
                                          LabelFormat="{0}% complete" />
                            <RProgressBar Value="@_uploadProgress3" 
                                          Text="backup.zip" 
                                          Variant="ProgressVariant.Warning"
                                          ShowLabel="true" />
                        </div>
                    </div>

                    <div>
                        <p class="text-sm text-muted mb-3">System Health Metrics</p>
                        <div class="space-y-3">
                            <RProgressBar Value="85" 
                                          Text="CPU Usage" 
                                          Variant="ProgressVariant.Success"
                                          ShowLabel="true"
                                          LabelFormat="{0}%" />
                            <RProgressBar Value="92" 
                                          Text="Memory Usage" 
                                          Variant="ProgressVariant.Warning"
                                          ShowLabel="true"
                                          LabelFormat="{0}%" />
                            <RProgressBar Value="98" 
                                          Text="Disk Usage" 
                                          Variant="ProgressVariant.Error"
                                          ShowLabel="true"
                                          LabelFormat="{0}% full" />
                        </div>
                    </div>

                    <div>
                        <p class="text-sm text-muted mb-3">Project Progress</p>
                        <div class="space-y-3">
                            <RProgressBar Value="45" 
                                          Text="Phase 1: Planning" 
                                          Variant="ProgressVariant.Primary"
                                          ShowLabel="true" />
                            <RProgressBar Value="78" 
                                          Text="Phase 2: Development" 
                                          Variant="ProgressVariant.Info"
                                          ShowLabel="true" />
                            <RProgressBar Value="100" 
                                          Text="Phase 3: Testing" 
                                          Variant="ProgressVariant.Success"
                                          ShowLabel="true" />
                        </div>
                    </div>

                    <div>
                        <p class="text-sm text-muted mb-3">Data Processing</p>
                        <div class="space-y-3">
                            <RProgressBar Value="@_processingProgress" 
                                          Text="Processing Records" 
                                          Variant="ProgressVariant.Primary"
                                          ShowLabel="true"
                                          LabelFormat="@($"{_processedRecords:N0} of {_totalRecords:N0} records ({0}%)")"
                                          Animated="true" />
                        </div>
                    </div>
                </div>
            </div>

            <!-- Interactive Demo -->
            <div class="space-y-2">
                <div class="text-h6 font-semibold">Interactive Demo</div>
                <div class="space-y-4">
                    <div class="flex items-center gap-4 flex-wrap">
                        <RButton Text="Start Progress" 
                                 @onclick="StartProgress"
                                 Variant="ButtonVariant.Primary"
                                 Size="SizeType.Small"
                                 Disabled="@_isProgressing" />
                        <RButton Text="Reset" 
                                 @onclick="ResetProgress"
                                 Variant="ButtonVariant.Secondary"
                                 Size="SizeType.Small" />
                        <RButton Text="Complete" 
                                 @onclick="CompleteProgress"
                                 Variant="ButtonVariant.Success"
                                 Size="SizeType.Small" />
                    </div>
                    
                    <RProgressBar Value="@_demoProgress" 
                                  Text="Interactive Progress" 
                                  Variant="@GetProgressVariant()"
                                  ShowLabel="true"
                                  Animated="@_isProgressing" />
                    
                    @if (_isProgressing)
                    {
                        <div class="text-sm text-info">
                            <i class="icon mr-1">autorenew</i>
                            Progress is running... (@_demoProgress.ToString("F1")%)
                        </div>
                    }
                </div>
            </div>

            <!-- Circular Progress -->
            <div class="space-y-2">
                <div class="text-h6 font-semibold">Circular Progress</div>
                <div class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="flex flex-col items-center gap-2">
                            <RProgressCircular Value="30" Text="Basic Circular" ShowValue="true" />
                            <span class="text-sm text-muted">30% Progress</span>
                        </div>
                        <div class="flex flex-col items-center gap-2">
                            <RProgressCircular Value="65" Variant="ProgressVariant.Success" ShowValue="true" />
                            <span class="text-sm text-muted">Success Variant</span>
                        </div>
                        <div class="flex flex-col items-center gap-2">
                            <RProgressCircular Value="85" Variant="ProgressVariant.Warning" ShowValue="true" />
                            <span class="text-sm text-muted">Warning Variant</span>
                        </div>
                    </div>
                    
                    <div class="space-y-3">
                        <p class="text-sm text-muted mb-2">Size Variants</p>
                        <div class="flex items-center gap-8">
                            <div class="flex flex-col items-center gap-2">
                                <RProgressCircular Value="45" Size="SizeType.Small" ShowValue="true" />
                                <span class="text-xs text-muted">Small</span>
                            </div>
                            <div class="flex flex-col items-center gap-2">
                                <RProgressCircular Value="65" Size="SizeType.Medium" ShowValue="true" />
                                <span class="text-xs text-muted">Medium</span>
                            </div>
                            <div class="flex flex-col items-center gap-2">
                                <RProgressCircular Value="85" Size="SizeType.Large" ShowValue="true" />
                                <span class="text-xs text-muted">Large</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="space-y-3">
                        <p class="text-sm text-muted mb-2">Indeterminate Circular</p>
                        <div class="flex items-center gap-8">
                            <div class="flex flex-col items-center gap-2">
                                <RProgressCircular Indeterminate="true" Text="Loading..." />
                                <span class="text-xs text-muted">Loading</span>
                            </div>
                            <div class="flex flex-col items-center gap-2">
                                <RProgressCircular Indeterminate="true" Variant="ProgressVariant.Success" Size="SizeType.Large" />
                                <span class="text-xs text-muted">Processing</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="space-y-3">
                        <p class="text-sm text-muted mb-2">Interactive Circular Progress</p>
                        <div class="flex items-center gap-6">
                            <RProgressCircular Value="@_demoProgress" 
                                              Variant="@GetProgressVariant()" 
                                              ShowValue="true"
                                              Size="SizeType.Large" 
                                              LabelFormat="{0:F1}%" />
                            <div class="flex flex-col gap-2">
                                <RButton Text="Start" @onclick="StartProgress" Size="SizeType.Small" Disabled="@_isProgressing" />
                                <RButton Text="Reset" @onclick="ResetProgress" Size="SizeType.Small" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Multi-Step Progress -->
            <div class="space-y-2">
                <div class="text-h6 font-semibold">Multi-Step Progress</div>
                <div class="space-y-4">
                    <div class="flex items-center gap-4 flex-wrap">
                        <RButton Text="Start Workflow" 
                                 @onclick="StartWorkflow"
                                 Variant="ButtonVariant.Primary"
                                 Size="SizeType.Small"
                                 Disabled="@_workflowRunning" />
                        <RButton Text="Reset Workflow" 
                                 @onclick="ResetWorkflow"
                                 Variant="ButtonVariant.Secondary"
                                 Size="SizeType.Small" />
                    </div>
                    
                    <div class="space-y-3">
                        <RProgressBar Value="@_step1Progress" 
                                      Text="Step 1: Initialization" 
                                      Variant="@GetStepVariant(_step1Progress)"
                                      ShowLabel="true" />
                        <RProgressBar Value="@_step2Progress" 
                                      Text="Step 2: Processing" 
                                      Variant="@GetStepVariant(_step2Progress)"
                                      ShowLabel="true" />
                        <RProgressBar Value="@_step3Progress" 
                                      Text="Step 3: Finalization" 
                                      Variant="@GetStepVariant(_step3Progress)"
                                      ShowLabel="true" />
                        <RProgressBar Value="@_overallProgress" 
                                      Text="Overall Progress" 
                                      Variant="ProgressVariant.Primary"
                                      ShowLabel="true"
                                      LabelInside="true"
                                      Size="SizeType.Large" />
                    </div>
                </div>
            </div>
        </div>
    </ChildContent>
</RCard>

@code {
    // File upload progress
    private double _uploadProgress1 = 34;
    private double _uploadProgress2 = 78;
    private double _uploadProgress3 = 91;

    // Data processing
    private double _processingProgress = 67;
    private int _processedRecords = 67432;
    private int _totalRecords = 100000;

    // Interactive demo
    private double _demoProgress = 0;
    private bool _isProgressing = false;
    private System.Threading.Timer _progressTimer;

    // Multi-step workflow
    private bool _workflowRunning = false;
    private double _step1Progress = 0;
    private double _step2Progress = 0;
    private double _step3Progress = 0;
    private double _overallProgress = 0;
    private System.Threading.Timer _workflowTimer;
    private int _workflowStep = 0;

    private ProgressVariant GetProgressVariant()
    {
        if (_demoProgress >= 100) return ProgressVariant.Success;
        if (_demoProgress >= 75) return ProgressVariant.Info;
        if (_demoProgress >= 50) return ProgressVariant.Primary;
        return ProgressVariant.Info;
    }

    private ProgressVariant GetStepVariant(double progress)
    {
        if (progress >= 100) return ProgressVariant.Success;
        if (progress > 0) return ProgressVariant.Primary;
        return ProgressVariant.Info;
    }

    private void StartProgress()
    {
        if (_isProgressing) return;
        
        _isProgressing = true;
        _demoProgress = 0;
        
        _progressTimer = new System.Threading.Timer(UpdateProgress, null, 0, 100);
    }

    private void UpdateProgress(object state)
    {
        if (_demoProgress >= 100)
        {
            _progressTimer?.Dispose();
            _isProgressing = false;
            InvokeAsync(StateHasChanged);
            return;
        }
        
        _demoProgress += 0.8;
        if (_demoProgress > 100) _demoProgress = 100;
        
        InvokeAsync(StateHasChanged);
    }

    private void ResetProgress()
    {
        _progressTimer?.Dispose();
        _isProgressing = false;
        _demoProgress = 0;
    }

    private void CompleteProgress()
    {
        _progressTimer?.Dispose();
        _isProgressing = false;
        _demoProgress = 100;
    }

    private void StartWorkflow()
    {
        if (_workflowRunning) return;
        
        _workflowRunning = true;
        _workflowStep = 0;
        _step1Progress = 0;
        _step2Progress = 0;
        _step3Progress = 0;
        _overallProgress = 0;
        
        _workflowTimer = new System.Threading.Timer(UpdateWorkflow, null, 0, 50);
    }

    private void UpdateWorkflow(object state)
    {
        switch (_workflowStep)
        {
            case 0: // Step 1
                _step1Progress += 2;
                if (_step1Progress >= 100)
                {
                    _step1Progress = 100;
                    _workflowStep = 1;
                }
                break;
            case 1: // Step 2
                _step2Progress += 1.5;
                if (_step2Progress >= 100)
                {
                    _step2Progress = 100;
                    _workflowStep = 2;
                }
                break;
            case 2: // Step 3
                _step3Progress += 3;
                if (_step3Progress >= 100)
                {
                    _step3Progress = 100;
                    _workflowStep = 3;
                }
                break;
            case 3: // Complete
                _workflowTimer?.Dispose();
                _workflowRunning = false;
                break;
        }
        
        _overallProgress = (_step1Progress + _step2Progress + _step3Progress) / 3;
        
        InvokeAsync(StateHasChanged);
    }

    private void ResetWorkflow()
    {
        _workflowTimer?.Dispose();
        _workflowRunning = false;
        _workflowStep = 0;
        _step1Progress = 0;
        _step2Progress = 0;
        _step3Progress = 0;
        _overallProgress = 0;
    }

    public void Dispose()
    {
        _progressTimer?.Dispose();
        _workflowTimer?.Dispose();
    }
}