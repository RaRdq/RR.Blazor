@using RR.Blazor.Components.Core
@using RR.Blazor.Components.Display  
@using RR.Blazor.Components.Data
@using RR.Blazor.Enums

<RCard Variant="CardVariant.Outlined" Text="RGrid">
    <ChildContent>
        <RDivider Text="Smart Data Grid Component"
                  Subtitle="Advanced grid with virtualization, filtering, sorting, grouping, and export capabilities"
                  Icon="grid_view" />
        
        <div class="space-y-6">
            <!-- Basic Grid Example -->
            <div class="space-y-2">
                <div class="text-h6 font-semibold">Basic Grid</div>
                <RGrid DataSource="@_employees"
                       EnablePaging="true"
                       PageSize="5"
                       EnableSorting="true"
                       Class="basic-grid">
                    <!-- Auto-generated columns -->
                </RGrid>
            </div>

            <!-- Advanced Grid with Features -->
            <div class="space-y-2">
                <div class="text-h6 font-semibold">Advanced Grid with All Features</div>
                <div class="flex gap-2 mb-3">
                    <RButton Text="@(_enableVirtualization ? "Disable Virtualization" : "Enable Virtualization")"
                             Variant="ButtonVariant.Secondary"
                             Size="SizeType.Small"
                             @onclick="ToggleVirtualization" />
                    <RButton Text="@(_enableFiltering ? "Disable Filtering" : "Enable Filtering")"
                             Variant="ButtonVariant.Secondary"
                             Size="SizeType.Small"
                             @onclick="ToggleFiltering" />
                    <RButton Text="@(_enableExport ? "Disable Export" : "Enable Export")"
                             Variant="ButtonVariant.Secondary"
                             Size="SizeType.Small"
                             @onclick="ToggleExport" />
                </div>
                
                <RGrid DataSource="@_employees"
                       EnablePaging="true"
                       PageSize="10"
                       EnableSorting="true"
                       EnableFiltering="@_enableFiltering"
                       EnableGrouping="true"
                       EnableColumnReordering="true"
                       EnableExport="@_enableExport"
                       EnableVirtualization="@_enableVirtualization"
                       VirtualizationThreshold="100"
                       EnableRowSelection="true"
                       SelectionMode="GridSelectionMode.Multiple"
                       OnRowClick="@HandleRowClick"
                       OnSelectionChanged="@HandleSelectionChanged"
                       Class="advanced-grid">
                    <!-- Auto-generated columns with smart detection -->
                </RGrid>
                
                @if (_selectedEmployees?.Any() == true)
                {
                    <RAlert Type="AlertType.Info" Variant="AlertVariant.Filled">
                        <ChildContent>
                            Selected @_selectedEmployees.Count() employees: @string.Join(", ", _selectedEmployees.Select(e => e.Name).Take(3))@(_selectedEmployees.Count() > 3 ? $" and {_selectedEmployees.Count() - 3} more..." : "")
                        </ChildContent>
                    </RAlert>
                }
            </div>

            <!-- Performance Grid -->
            <div class="space-y-2">
                <div class="text-h6 font-semibold">Performance Grid (Large Dataset)</div>
                <div class="flex gap-2 mb-3">
                    <RButton Text="Load 1K Records"
                             Variant="@(_dataSize == 1000 ? ButtonVariant.Primary : ButtonVariant.Secondary)"
                             Size="SizeType.Small"
                             @onclick="@(() => LoadDataset(1000))" />
                    <RButton Text="Load 5K Records"
                             Variant="@(_dataSize == 5000 ? ButtonVariant.Primary : ButtonVariant.Secondary)"
                             Size="SizeType.Small"
                             @onclick="@(() => LoadDataset(5000))" />
                    <RButton Text="Load 10K Records"
                             Variant="@(_dataSize == 10000 ? ButtonVariant.Primary : ButtonVariant.Secondary)"
                             Size="SizeType.Small"
                             @onclick="@(() => LoadDataset(10000))" />
                </div>
                
                <div class="mb-3 text-sm text-muted">
                    Current dataset: @_dataSize.ToString("N0") records | Render time: @_renderTime.ToString("F1")ms
                </div>
                
                <RGrid DataSource="@_largeEmployees"
                       EnablePaging="true"
                       PageSize="25"
                       EnableSorting="true"
                       EnableVirtualization="true"
                       VirtualizationThreshold="100"
                       EnableRowSelection="true"
                       Class="performance-grid">
                    <!-- Auto-generated columns -->
                </RGrid>
            </div>

            <!-- Grid Density Options -->
            <div class="space-y-2">
                <div class="text-h6 font-semibold">Grid Density</div>
                <div class="flex gap-2 mb-3">
                    <RButton Text="Compact"
                             Variant="@(_density == "compact" ? ButtonVariant.Primary : ButtonVariant.Secondary)"
                             Size="SizeType.Small"
                             @onclick="@(() => SetDensity("compact"))" />
                    <RButton Text="Normal"
                             Variant="@(_density == "normal" ? ButtonVariant.Primary : ButtonVariant.Secondary)"
                             Size="SizeType.Small"
                             @onclick="@(() => SetDensity("normal"))" />
                    <RButton Text="Spacious"
                             Variant="@(_density == "spacious" ? ButtonVariant.Primary : ButtonVariant.Secondary)"
                             Size="SizeType.Small"
                             @onclick="@(() => SetDensity("spacious"))" />
                </div>
                
                <RGrid DataSource="@_employees.Take(8).ToList()"
                       EnablePaging="false"
                       EnableSorting="true"
                       Class="@($"density-grid density-{_density}")">
                    <!-- Auto-generated columns -->
                </RGrid>
            </div>
        </div>
    </ChildContent>
</RCard>

@code {
    // Sample data
    private List<Employee> _employees = new();
    private List<Employee> _largeEmployees = new();
    private IEnumerable<Employee> _selectedEmployees = Enumerable.Empty<Employee>();
    
    // Configuration
    private bool _enableVirtualization = true;
    private bool _enableFiltering = true;
    private bool _enableExport = true;
    private string _density = "normal";
    private int _dataSize = 1000;
    private double _renderTime = 0;

    protected override Task OnInitializedAsync()
    {
        _employees = GenerateEmployeeData(20);
        _largeEmployees = GenerateEmployeeData(_dataSize);
        return base.OnInitializedAsync();
    }

    private List<Employee> GenerateEmployeeData(int count)
    {
        var departments = new[] { "Engineering", "Sales", "Marketing", "HR", "Finance", "Operations" };
        var positions = new[] { "Manager", "Senior", "Junior", "Lead", "Specialist", "Coordinator" };
        var random = new Random(42);

        return Enumerable.Range(1, count).Select(i => new Employee
        {
            Id = i,
            Name = $"Employee {i:D3}",
            Department = departments[random.Next(departments.Length)],
            Position = $"{positions[random.Next(positions.Length)]}",
            Salary = random.Next(50000, 150000),
            HireDate = DateTime.Now.AddDays(-random.Next(1, 1000)),
            IsActive = random.NextDouble() > 0.1,
            Email = $"employee{i:D3}@company.com"
        }).ToList();
    }

    private void ToggleVirtualization() => _enableVirtualization = !_enableVirtualization;
    private void ToggleFiltering() => _enableFiltering = !_enableFiltering;
    private void ToggleExport() => _enableExport = !_enableExport;

    private void SetDensity(string density)
    {
        _density = density;
    }

    private async Task LoadDataset(int size)
    {
        var startTime = DateTime.UtcNow;
        _dataSize = size;
        _largeEmployees = GenerateEmployeeData(size);
        _renderTime = (DateTime.UtcNow - startTime).TotalMilliseconds;
        StateHasChanged();
    }

    private async Task HandleRowClick(object rowData)
    {
        if (rowData is Employee employee)
        {
            // Handle row click - could show details modal
        }
    }

    private async Task HandleSelectionChanged(object selection)
    {
        if (selection is IEnumerable<Employee> employees)
        {
            _selectedEmployees = employees;
            StateHasChanged();
        }
    }

    public class Employee
    {
        public int Id { get; set; }
        public string Name { get; set; } = string.Empty;
        public string Department { get; set; } = string.Empty;
        public string Position { get; set; } = string.Empty;
        public decimal Salary { get; set; }
        public DateTime HireDate { get; set; }
        public bool IsActive { get; set; }
        public string Email { get; set; } = string.Empty;
    }
}